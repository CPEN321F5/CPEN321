Index: app/src/main/java/com/cpen321/f5/ItemActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.cpen321.f5;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.core.app.ActivityCompat;\r\nimport androidx.core.content.ContextCompat;\r\n\r\nimport android.Manifest;\r\nimport android.annotation.SuppressLint;\r\nimport android.content.Context;\r\nimport android.content.Intent;\r\nimport android.content.pm.PackageManager;\r\nimport android.location.Address;\r\nimport android.location.Geocoder;\r\nimport android.location.Location;\r\nimport android.location.LocationListener;\r\nimport android.location.LocationManager;\r\nimport android.os.Bundle;\r\nimport android.util.Log;\r\nimport android.view.View;\r\nimport android.widget.Button;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport com.android.volley.Request;\r\nimport com.android.volley.RequestQueue;\r\nimport com.android.volley.Response;\r\nimport com.android.volley.VolleyError;\r\nimport com.android.volley.toolbox.JsonObjectRequest;\r\nimport com.android.volley.toolbox.Volley;\r\n\r\nimport org.json.JSONException;\r\nimport org.json.JSONObject;\r\n\r\nimport java.io.IOException;\r\nimport java.util.Formatter;\r\nimport java.util.List;\r\nimport java.util.Locale;\r\n\r\npublic class ItemActivity extends AppCompatActivity implements LocationListener {\r\n\r\n    private static final String TAG = \"ItemActivity\";\r\n\r\n    public static String stepPrice;\r\n    public static String itemPrice;\r\n    public static String highestPriceHolder;\r\n    public static String expireTime;\r\n    public static String sellerID;\r\n\r\n    RequestQueue requestQueue;\r\n\r\n    TextView _itemName;\r\n    TextView _itemPrice;\r\n    TextView _itemCategory;\r\n    TextView _itemDescription;\r\n    TextView _itemLocation;\r\n    TextView _itemNumber;\r\n\r\n    private Button bidButton;\r\n    private Button contactsellerButton;\r\n\r\n\r\n    String itemName;\r\n    //String itemPrice;\r\n    String itemCategory;\r\n    String itemDescription;\r\n    String itemLocationLong;\r\n    String itemLocationLat;\r\n    String itemNumber;\r\n\r\n    public static String itemID;\r\n    String tmpID = ItemListActivity.ItemID;\r\n\r\n    String GETITEMURL = \"http://20.106.78.177:8081/item/getbyid/\" + tmpID + \"/\";;\r\n\r\n    LocationManager locationManager;\r\n    private double distance;\r\n    private double lat, lon;\r\n    private double lat_item, lon_item;\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState)\r\n    {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_item);\r\n\r\n        locationManager = (LocationManager) getSystemService(Context.LOCATION_SERVICE);\r\n        if (ContextCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED && ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_COARSE_LOCATION) != PackageManager.PERMISSION_GRANTED) {\r\n            // TODO: Consider calling\r\n            //    ActivityCompat#requestPermissions\r\n            // here to request the missing permissions, and then overriding\r\n            //   public void onRequestPermissionsResult(int requestCode, String[] permissions,\r\n            //                                          int[] grantResults)\r\n            // to handle the case where the user grants the permission. See the documentation\r\n            // for ActivityCompat#requestPermissions for more details.\r\n            return;\r\n        }\r\n        locationManager.requestLocationUpdates(LocationManager.GPS_PROVIDER, 1000, 0, (LocationListener) this);\r\n\r\n        distance = distance(lat, lon, lat_item, lon_item, 'K');\r\n\r\n        Log.d(TAG, \"lat = \" + lat);\r\n        Log.d(TAG, \"lon = \" + lon);\r\n        Log.d(TAG, \"lat_item = \" + lat_item);\r\n        Log.d(TAG, \"lon_item = \" + lon_item);\r\n\r\n        Log.d(TAG, \"distance = \" + distance);\r\n\r\n        requestQueue = Volley.newRequestQueue(this);\r\n\r\n        Log.d(TAG, GETITEMURL);\r\n        GETITEM();\r\n\r\n        String chat_init_url = \"http://20.106.78.177:8081/chat/initconversation/\";\r\n        String myID = MainActivity.idOfUser;\r\n\r\n        bidButton = findViewById(R.id.bid_button);\r\n        bidButton.setOnClickListener(new View.OnClickListener()\r\n        {\r\n\r\n            @Override\r\n            public void onClick(View v)\r\n            {\r\n                itemID = tmpID;\r\n                Intent bidIntent = new Intent(ItemActivity.this, BidActivity.class);\r\n                startActivity(bidIntent);\r\n            }\r\n        });\r\n\r\n        contactsellerButton = findViewById(R.id.contact_seller_button);\r\n        contactsellerButton.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                //init userid2 string here to wait for GETITEM response\r\n                String userID2 = ItemActivity.sellerID;\r\n                String chat_url = chat_init_url + myID + \"/\" + userID2;\r\n\r\n                RequestQueue queue = Volley.newRequestQueue(ItemActivity.this);\r\n                Intent intent = new Intent(ItemActivity.this, ChatAcitivity.class);\r\n                Log.d(\"CHAT\", \"starting chat with url\" + chat_url);\r\n                JsonObjectRequest jsonObjectRequest = new JsonObjectRequest(Request.Method.POST, chat_url, null, new Response.Listener<JSONObject>() {\r\n                    @Override\r\n                    public void onResponse(JSONObject response) {\r\n                        try {\r\n                            response.put(\"myID\", myID);\r\n                        } catch (JSONException e) {\r\n                            e.printStackTrace();\r\n                        }\r\n                        Log.d(\"CHAT\", response.toString());\r\n                        intent.putExtra(\"conversations\", response.toString());\r\n                        startActivity(intent);\r\n                    }\r\n                }, new Response.ErrorListener() {\r\n                    @Override\r\n                    public void onErrorResponse(VolleyError error) {\r\n                        Log.d(\"TEST1\", error.getMessage());\r\n                    }\r\n                });\r\n                queue.add(jsonObjectRequest);\r\n            }\r\n        });\r\n    }\r\n\r\n    private void GETITEM ()\r\n    {\r\n        JsonObjectRequest jsonObjectRequest = new JsonObjectRequest(Request.Method.GET, GETITEMURL, null, new Response.Listener<JSONObject>()\r\n        {\r\n            @SuppressLint(\"SetTextI18n\")\r\n            @Override\r\n            public void onResponse(JSONObject response)\r\n            {\r\n                Log.d(TAG, \"attribute = \" + response.toString());\r\n\r\n                try\r\n                {\r\n                    itemName = response.getString(\"name\");\r\n                    itemPrice = response.getString(\"currentPrice\");\r\n                    itemCategory = response.getString(\"name\");\r\n                    itemLocationLong = response.getString(\"location_lon\");\r\n                    itemLocationLat = response.getString(\"location_lat\");\r\n                    itemNumber = response.getString(\"ItemID\");\r\n                    itemDescription = response.getString(\"description\");\r\n                    sellerID = response.getString(\"sellerID\");\r\n                    highestPriceHolder = response.getString(\"currentPriceHolder\");\r\n                    stepPrice = response.getString(\"stepPrice\");\r\n                    expireTime = response.getString(\"timeExpire\");\r\n//                            \"1320105600\";\r\n\r\n                    lat_item = Double.parseDouble(itemLocationLong);\r\n                    lon_item = Double.parseDouble(itemLocationLat);\r\n\r\n                    _itemName = findViewById(R.id.item_name_caption);\r\n                    _itemName.setText(itemName);\r\n\r\n                    _itemPrice = findViewById(R.id.item_price_caption);\r\n                    _itemPrice.setText(\"$ \" + itemPrice);\r\n\r\n                    _itemCategory = findViewById(R.id.item_category_caption);\r\n                    _itemCategory.setText(itemCategory);\r\n\r\n                    _itemLocation = findViewById(R.id.item_location_caption);\r\n                    _itemLocation.setText(\"Distance to you: \" + Double.toString(distance));\r\n\r\n                    _itemNumber = findViewById(R.id.item_id_caption);\r\n                    _itemNumber.setText(\"Item ID: \" + itemNumber);\r\n\r\n                    _itemDescription = findViewById(R.id.item_description_caption);\r\n                    _itemDescription.setText(itemDescription);\r\n\r\n                    Toast.makeText(ItemActivity.this, \"CREDENTIALS RETRIEVED\", Toast.LENGTH_LONG).show();\r\n                }\r\n                catch (Exception w)\r\n                {\r\n                    Toast.makeText(ItemActivity.this,w.getMessage(),Toast.LENGTH_LONG).show();\r\n                }\r\n            }\r\n        }, new Response.ErrorListener()\r\n        {\r\n            @Override\r\n            public void onErrorResponse(VolleyError error)\r\n            {\r\n                Toast.makeText(ItemActivity.this,error.getMessage(),Toast.LENGTH_LONG).show();\r\n            }\r\n        });\r\n\r\n        requestQueue.add(jsonObjectRequest);\r\n    }\r\n\r\n    private double distance(double lat1, double lon1, double lat2, double lon2, char unit) {\r\n        double theta = lon1 - lon2;\r\n        double dist = Math.sin(degToRad(lat1)) * Math.sin(degToRad(lat2)) + Math.cos(degToRad(lat1)) * Math.cos(degToRad(lat2)) * Math.cos(degToRad(theta));\r\n        dist = Math.acos(dist);\r\n        dist = radToDeg(dist);\r\n        dist = dist * 60 * 1.1515;\r\n        if (unit == 'K') {\r\n            dist = dist * 1.609344;\r\n        } else if (unit == 'N') {\r\n            dist = dist * 0.8684;\r\n        }\r\n        return (dist);\r\n    }\r\n\r\n    private double degToRad(double deg) {\r\n        return (deg * Math.PI / 180.0);\r\n    }\r\n    private double radToDeg(double rad) {\r\n        return (rad * 180.0 / Math.PI);\r\n    }\r\n    @Override\r\n    public void onLocationChanged(@NonNull Location location) {\r\n        Log.d(TAG, \"Lat: \" + location.getLatitude() + \" | Long: \" + location.getLongitude());\r\n        lat = location.getLatitude();\r\n        lon = location.getLongitude();\r\n\r\n        Geocoder geocoder = new Geocoder(this, Locale.getDefault());\r\n\r\n        try {\r\n            List<Address> addresses = geocoder.getFromLocation(lat, lon, 1);\r\n            Log.d(TAG, \"debug sign: \" + addresses.size() + \"---\" + lat + \"---\" + lon);\r\n            String cityName = addresses.get(0).getLocality();\r\n            //Log.d(TAG, \"*************city name: \" + cityName);\r\n\r\n            Formatter formatter = new Formatter();\r\n            formatter.format(\"%.5f\", lat);\r\n            formatter.format(\"%.5f\", lon);\r\n\r\n\r\n        } catch (IOException e) {\r\n            e.printStackTrace();\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void onLocationChanged(@NonNull List<Location> locations) {\r\n        LocationListener.super.onLocationChanged(locations);\r\n    }\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/cpen321/f5/ItemActivity.java b/app/src/main/java/com/cpen321/f5/ItemActivity.java
--- a/app/src/main/java/com/cpen321/f5/ItemActivity.java	(revision 5db829a9f68791b4469fc2d1f5cb068e455e5f9d)
+++ b/app/src/main/java/com/cpen321/f5/ItemActivity.java	(date 1657594220236)
@@ -83,7 +83,7 @@
     {
         super.onCreate(savedInstanceState);
         setContentView(R.layout.activity_item);
-
+        GETITEM();
         locationManager = (LocationManager) getSystemService(Context.LOCATION_SERVICE);
         if (ContextCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED && ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_COARSE_LOCATION) != PackageManager.PERMISSION_GRANTED) {
             // TODO: Consider calling
@@ -109,7 +109,7 @@
         requestQueue = Volley.newRequestQueue(this);
 
         Log.d(TAG, GETITEMURL);
-        GETITEM();
+
 
         String chat_init_url = "http://20.106.78.177:8081/chat/initconversation/";
         String myID = MainActivity.idOfUser;
